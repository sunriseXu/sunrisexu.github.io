<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Git remote origin leaks user access token(Invalid) | sunriseXu’s bug hunting journey</title>
<meta name="generator" content="Jekyll v4.3.3" />
<meta property="og:title" content="Git remote origin leaks user access token(Invalid)" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Name" />
<meta property="og:description" content="Name" />
<link rel="canonical" href="http://0.0.0.0:4000/file-overwrite/2024/07/01/git-origin-leak-access-token.html" />
<meta property="og:url" content="http://0.0.0.0:4000/file-overwrite/2024/07/01/git-origin-leak-access-token.html" />
<meta property="og:site_name" content="sunriseXu’s bug hunting journey" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-07-01T10:31:06+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Git remote origin leaks user access token(Invalid)" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-07-01T10:31:06+08:00","datePublished":"2024-07-01T10:31:06+08:00","description":"Name","headline":"Git remote origin leaks user access token(Invalid)","mainEntityOfPage":{"@type":"WebPage","@id":"http://0.0.0.0:4000/file-overwrite/2024/07/01/git-origin-leak-access-token.html"},"url":"http://0.0.0.0:4000/file-overwrite/2024/07/01/git-origin-leak-access-token.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://0.0.0.0:4000/feed.xml" title="sunriseXu&apos;s bug hunting journey" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">sunriseXu&#39;s bug hunting journey</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Git remote origin leaks user access token(Invalid)</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2024-07-01T10:31:06+08:00" itemprop="datePublished">Jul 1, 2024
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h2 id="name">Name</h2>

<blockquote>
  <p>Git remote origin leaks user access token</p>
</blockquote>

<h2 id="version">Version</h2>

<blockquote>
  <p>2.45.2</p>
</blockquote>

<h2 id="description">Description</h2>

<p>Lots of people are using personal access token to clone their private repository. To use a access token, you can include your username and token in https url to clone projects on github, gitlab or any other DevOps Platform:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://&lt;username&gt;:&lt;token&gt;@github.com/username/repository.git
</code></pre></div></div>

<p>However, we can get the token back easily by just using <code class="language-plaintext highlighter-rouge">git remote get-url origin</code>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd privateProject
git remote get-url origin
&gt; https://username:ghp_xxxxx@github.com/username/repository.git
</code></pre></div></div>

<p>This can be dangerous, because we often run third party tools in our private repository. If a malicious tool runs <code class="language-plaintext highlighter-rouge">git remote get-url origin</code>, it can steal our personal access token of github or gitlab. In this case, our github/gitlab will be controlled by attackers which can have severe consequences.</p>

<p>I found this issue during code auditing via <a href="https://github.com/pyupio/safety">safety tool</a>. After scanning a project using <code class="language-plaintext highlighter-rouge">safety check -r requirements.txt --save-json test.json</code>, safety saved results into <code class="language-plaintext highlighter-rouge">test.json</code> file. However, when I looked into <code class="language-plaintext highlighter-rouge">test.json</code>, I found my personal access token in this file.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>"report_meta": {
    "scan_target": "files",
    "scanned": [
        "/home/kali/huntr/azure-sdk-for-python/tools/azure-sdk-tools/ci_tools/versioning/requirements.txt"
    ],
    "target_languages": [
        "python"
    ],
    "git": {
        "branch": "main",
        "tag": "",
        "commit": "b182b0c4f9d07d18f118130bc941c3b7a75667b1",
        "dirty": false,
        "origin": "https://outh2:ghp_xxxx@github.com/sunriseXu/xxxx.git"
    },
}
</code></pre></div></div>

<p>So, I looked into the source code of safety. The class <a href="https://github.com/pyupio/safety/blob/f15d7908d27fd887dcc6b31237b8e3df79a9359b/safety/scan/util.py#L49"><code class="language-plaintext highlighter-rouge">GIT</code></a> is responsible for collecting repository information in current repo where safety runs.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class GIT:
    ORIGIN_CMD: Tuple[str, ...] = ("remote", "get-url", "origin")
    def __run__(self, cmd: Tuple[str, ...], env_var: Optional[str] = None) -&gt; Optional[str]:
        if env_var and os.environ.get(env_var):
            return os.environ.get(env_var)

        try:
            return subprocess.run(self.git + cmd, stdout=subprocess.PIPE, 
                                    stderr=subprocess.DEVNULL).stdout.decode('utf-8').strip()
        except Exception as e:
            LOG.exception(e)
        
        return None
    def origin(self) -&gt; Optional[str]:
        # get the origin of repository
        return self.__run__(self.ORIGIN_CMD, env_var="SAFETY_GIT_ORIGIN")
</code></pre></div></div>

<h2 id="impact">Impact</h2>

<p>This can have severe consequences. <strong>Any</strong> tools running in private repositories have ability to steal personal access token if the token is written in git remote url explicitly. Git should mask user’s access token when using cli command <code class="language-plaintext highlighter-rouge">git remote get-url origin</code>.</p>


  </div><a class="u-url" href="/file-overwrite/2024/07/01/git-origin-leak-access-token.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">sunriseXu&#39;s bug hunting journey</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">sunriseXu&#39;s bug hunting journey</li><li><a class="u-email" href="mailto:github@example.com">github@example.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/jekyll"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">jekyll</span></a></li><li><a href="https://www.twitter.com/jekyllrb"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">jekyllrb</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>sunriseXu&#39;s bug hunting journey, sharing new findings of bug hunting.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
